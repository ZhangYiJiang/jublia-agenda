<div *ngIf="!agenda">
  Loading...
</div>
<div *ngIf="agenda">
  <div class="agenda-header">
    <h1 class="agenda-title">Agenda for <strong>{{agenda.name}}</strong></h1>
    <div class="agenda-menu">
      <button md-button [class.warn]="!agenda.published" [class.secondary]="agenda.published" (click)="openPublishModal()">Publish</button>
      <button md-button class="secondary" *ngIf="agenda.published" routerLink="/analytics/agenda/{{agendaId}}">Analytics</button>
      <button md-button class="secondary" (click)="showAgendaSettings()">
        <i class="fa fa-cog" aria-hidden="true"></i> Event Settings
      </button>
    </div>
  </div>
  <board #board *ngIf="agenda" [agenda]="agenda" [isPublic]="false" [isAnalytics]="false">
  </board>
</div>

<template #templateRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
  <div class="modal-container edit-agenda">
    <div class="page-header">
      <h1>Event Settings</h1>
    </div>
    <div class="jumbotron">
      <h2>Event Name:</h2>
      <p class="full-width">
        <ndv-edit [title]="'name'" [placeholder]="agenda.name" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-edit>
      </p>
      
      <h2>Description:</h2>
      <p class="full-width">
        <ndv-area [title]="'description'" [placeholder]="agenda.description" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-area>
      </p>
      
      <h2>Duration</h2>
      <p>
        <ndv-edit [title]="'duration'" [placeholder]="agenda.duration" (onSave)="updateAgenda($event)" 
                  [permission]="true" [regex]="'^[1-9]$'" 
                  [error]="'Please enter a number between 1 to 9.'" class="small-input"></ndv-edit> days
      </p>
      
      <h2>Location</h2>
      <p class="full-width">
        <ndv-edit [title]="'location'" [placeholder]="agenda.location" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-edit>
      </p>
      
      <h2>Website</h2>
      <p class="full-width">
        <ndv-edit [title]="'website'" [placeholder]="agenda.website" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-edit>
      </p>

    </div>
    
    <button md-button class="secondary" (click)="dialogRef.close(true)">Close</button>
  </div>
</template>

<template #publishRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
    <div class="modal-container publish-agenda">
      <p>After publishing the event, anyone with your event's public link will be 
        able to view and bookmark sessions on your event.</p>
      <p>You will get participants statistics such as popularity of the sessions in the 
        Analytics page (only available after publishing).</p>
      
      <div class="bottom-buttons" *ngIf="!agenda.published">
        <button md-button class="primary" (click)="publishAgenda()">Publish</button>
        <button md-button class="secondary" (click)="dialogRef.close(true)">Cancel</button>
      </div>
      
      <template [ngIf]="agenda.published">
        <div class="share-link">
          <span class="share-link-url">{{publicUrl}}</span>
          <button type="button" ngIIclipboard 
                  [cbContent]="publicUrl" 
                  (cbOnSuccess)="clipboardStatus = 'Link successfully copied'" 
                  (cbOnError)="clipboardStatus = 'Press Ctrl+C to copy'">
            <i class="fa fa-clipboard" title="Copy Link"></i>
          </button>
        </div>
        
        <p class="clipboard-status" *ngIf="clipboardStatus">{{ clipboardStatus }}</p>
        
        <div class="bottom-buttons">
          <button md-button class="primary" (click)="dialogRef.close(true)">Ok</button>
          <button md-button class="secondary" (click)="unpublishAgenda()">Unpublish</button>
        </div>
      </template>
    </div>
</template>