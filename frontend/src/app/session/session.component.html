<div *ngIf="session.placeholder" class="placeholder-session"></div>
<div *ngIf="!session.placeholder" class="session-tile" [style.height]="session.start_at == null?'initial':height + 'px'" [style.background-color]="'rgb('+red+','+green+','+blue+')'" [class.pending]="session.start_at == null" [class.static]="isPublic" (click)="clicked($event)" [class.not-interested]="!interested">
  <div class="session-content">
    <div class="session-title">
      <i class="fa fa-star" aria-hidden="true" *ngIf="interested"></i> {{session.name}}</div>
    <!-- session time format is 'HH:mm - HH:mm' -->
    <div *ngIf="session.start_at && session.duration >= 60" class="session-time">
      {{getDisplayedTime()}}</div>
    <div *ngIf="!session.start_at && session.duration" class="session-time">
      {{session.duration}} min</div>
    <div class="session-venue">{{getSessionName(session.venue)}}</div>
  </div>
</div>

<template #templateRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
  <div class="modal-container">
    <div class="page-header">
      <button *ngIf="token" md-button class="interestBtn" [class.primary]="interested" [class.secondary]="!interested" (click)="updateInterest()">
        <i class="fa fa-star" aria-hidden="true" *ngIf="interested"></i> {{interestedButtonText}}
      </button>

      <h1 class="full-width"><ndv-edit [title]="'name'" [placeholder]="session.name" (onSave)="updateSession($event)" [permission]="!isPublic"></ndv-edit></h1>
    </div>
    
    <div class="session-body">
      <div class="session-main">
        
        <div>
          <p class="full-width">
            <ndv-area [title]="'description'" [placeholder]="session.description || 'Enter description here'" (onSave)="updateSession($event)" [permission]="!isPublic"></ndv-area>
          </p>
        </div>

        <h2><i class="fa fa-user" aria-hidden="true"></i> Speakers</h2>
        <div *ngIf="session.speakers">
          <div class="speaker-card" *ngFor="let speakerId of session.speakers">
            <h3>
              <ndv-edit [title]="'name'" [placeholder]="speakersObj[speakerId].name" (onSave)="updateSpeaker($event, speakerId)" [permission]="!isPublic"></ndv-edit>
              <div class="delete-button" *ngIf="!isPublic">
                <button class="primary" md-button (click)="updateSessionSpeaker(speakerId)">x</button>
              </div>
            </h3>
            <p><ndv-edit [title]="'position'" [placeholder]="speakersObj[speakerId].position" (onSave)="updateSpeaker($event, speakerId)" [permission]="!isPublic"></ndv-edit></p>
            <p>Email: <ndv-edit [title]="'email'" [placeholder]="speakersObj[speakerId].email" (onSave)="updateSpeaker($event, speakerId)" [permission]="!isPublic"></ndv-edit></p>
            <p>Phone: <ndv-edit [title]="'phone_number'" [placeholder]="speakersObj[speakerId].phone_number" (onSave)="updateSpeaker($event, speakerId)" [permission]="!isPublic"></ndv-edit></p>
          </div>
        </div>
        <div *ngIf="!session.speakers">
          <p>Speaker information not available.</p>
        </div>
      </div><!-- /.session-main -->
      
      <div class="session-meta">
        <div class="session-info">
          <div class="session-icon">
            <i class="fa fa-clock-o" aria-hidden="true"></i>
          </div>
          <div>
            <p *ngIf="session.start_at">{{ getDisplayedDate() }}</p>
            <p class="session-info-secondary">{{ getDisplayedTime() }}
              <ndv-edit class="small-input" [title]="'duration'" [placeholder]="session.duration || '0'"
                        (onSave)="updateSession($event)" [permission]="!isPublic"
                        [regex]="'^[0-9]+$'" [error]="'Please enter a number.'">
              </ndv-edit>mins
              <span *ngIf="!isPublic" class="duration-buttons">
              <button class="primary" md-button (click)="adjustSessionDuration(15)">+</button>
              <button class="primary" md-button (click)="adjustSessionDuration(-15)">-</button>
            </span>
            </p>
          </div>
        </div><!-- /.session-info -->
        
        <div *ngIf="session.track" class="session-info">
          <div class="session-icon">
            <i class="fa fa-list-ol" aria-hidden="true"></i>
          </div>
          <div>
            <p>{{trackObj[session.track].name}}</p>
          </div>
        </div><!-- /.session-info -->
        
        <h2><i class="fa fa-tachometer" aria-hidden="true"></i> Popularity</h2>
        <div *ngIf="!(session.popularity == null)">
          <p *ngIf="session.popularity === 0">No one has expressed interest in this session yet.</p>
          <p *ngIf="session.popularity === 1">One person is interested in this session.</p>
          <p *ngIf="session.popularity > 1">{{session.popularity}} people are interested in this session.</p>
        </div>
        <div *ngIf="session.popularity == null">
          <p>Popularity information not available.</p>
        </div>
      </div><!-- /.session-meta -->
    </div><!-- /.session-body -->
    
    <div class="session-footer">
      <button md-button class="interestBtn" [class.primary]="interested" [class.secondary]="!interested"
              (click)="updateInterest()" *ngIf="token">
        <i class="fa fa-star" aria-hidden="true" *ngIf="interested"></i> {{interestedButtonText}}
      </button>

      <button type="button" md-button class="warn" (click)="confirmDelete(dialogRef)">Delete</button>
      <button type="button" md-button class="secondary" (click)="dialogRef.close(true)">Close</button>
    </div>
  </div>
</template>
