<div *ngIf="!agenda">
  <loading-indicator></loading-indicator>
</div>
<div *ngIf="agenda">
  <div class="agenda-header">
    <h1 class="agenda-title">Agenda for <strong>{{agenda.name}}</strong></h1>
    <div class="agenda-menu">
      <button md-button disableRipple class="secondary" 
              *ngIf="agenda.hasDirtySession" (click)="openDirtyModal()">Notify Attendees</button>
      <button *ngIf="!agenda.published" md-button disableRipple 
              [class.warn]="!agenda.published" [class.secondary]="agenda.published" (click)="openPublishModal()">Publish</button>
      <button *ngIf="agenda.published" md-button disableRipple 
              [class.warn]="!agenda.published" [class.secondary]="agenda.published" (click)="openPublishModal()"><i class="fa fa-check" aria-hidden="true"></i> Published</button>
      <button md-button disableRipple class="secondary" 
              *ngIf="agenda.published" routerLink="/analytics/agenda/{{agendaId}}">Analytics</button>
      <button md-button disableRipple class="secondary" 
              (click)="showAgendaSettings()">
        <i class="fa fa-cog" aria-hidden="true"></i> Event Settings
      </button>
    </div>
  </div>
  <board #board *ngIf="agenda" [agenda]="agenda" [isPublic]="false" [isAnalytics]="false">
  </board>
</div>

<template #templateRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
  <div class="modal-container edit-agenda">
    <div class="modal-header">
      <h1>Event Settings</h1>
    </div>
    <div class="jumbotron">
      <h2>Event Name</h2>
      <p class="full-width">
        <ndv-edit [title]="'name'" [placeholder]="agenda.name" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-edit>
      </p>
      
      <h2>Description</h2>
      <p class="full-width">
        <ndv-area [title]="'description'" [placeholder]="agenda.description" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-area>
      </p>
      
      <div class="two-col">
        <div>
          <h2>Duration</h2>
          <p>
            <ndv-edit [title]="'duration'" [placeholder]="agenda.duration" (onSave)="updateAgenda($event)" 
                      [permission]="true" [regex]="'^[1-9]$'" 
                      [error]="'Please enter a number between 1 to 9.'" class="small-input"></ndv-edit> days
          </p>
        </div>
        <div>
          <h2>Date</h2>
          <p>
            <ndv-date [title]="'start_at'" [placeholder]="agenda.start_at" (onSave)="updateAgenda($event)"
                      [permission]="true"></ndv-date>
          </p>
        </div>
      </div>
      
      <h2>Location</h2>
      <p class="full-width">
        <ndv-edit [title]="'location'" [placeholder]="agenda.location" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-edit>
      </p>
      
      <h2>Website</h2>
      <p class="full-width">
        <ndv-edit [title]="'website'" [placeholder]="agenda.website" (onSave)="updateAgenda($event)" 
                  [permission]="true"></ndv-edit>
      </p>

    </div>
    
    <div class="modal-footer">
      <button md-button class="secondary" (click)="dialogRef.close(true)">Close</button>
    </div>
  </div>
</template>

<template #publishRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
    <div class="modal-container publish-agenda">
      <p>After publishing the event, anyone with your event's public link will be 
        able to view and bookmark sessions on your event.</p>
      <p>You will get participants statistics such as popularity of the sessions in the 
        Analytics page (only available after publishing).</p>
      
      <div class="bottom-buttons" *ngIf="!agenda.published">
        <button md-button class="primary" (click)="setPublishedStatus(true)">Publish</button>
        <button md-button class="secondary" (click)="dialogRef.close(true)">Cancel</button>
      </div>
      
      <template [ngIf]="agenda.published">
        <div class="share-link">
          <span class="share-link-url">{{publicUrl}}</span>
          <button type="button" ngIIclipboard 
                  [cbContent]="publicUrl" 
                  (cbOnSuccess)="clipboardStatus = 'Link copied'" 
                  (cbOnError)="clipboardStatus = 'Press ' + platform.copyShortcut() + ' to copy'">
            <i class="fa fa-clipboard"></i> 
            <span class="sr-only">Copy link to clipboard</span>
          </button>
        </div>
        
        <p class="clipboard-status" *ngIf="clipboardStatus">{{ clipboardStatus }}</p>
        
        <div class="modal-footer bottom-buttons">
          <button md-button disableRipple class="primary" (click)="dialogRef.close(true)">Ok</button>
          <button md-button disableRipple class="secondary" (click)="setPublishedStatus(false)">Unpublish</button>
        </div>
      </template>
    </div>
</template>

<template #dirtyRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
  <div class="dirty-sessions modal-container">
    <div class="modal-header">
      <h1>Notify Viewers of Session Updates</h1>
    </div>
    <p>You have made some changes to the sessions. The attendees who have 
      bookmarked the following events will get an email regarding the changes made. 
    </p>
    
    <dirty-session [agenda]="agenda"></dirty-session>
    
    <button md-button disableRipple type="button" class="primary" 
            (click)="sendViewerUpdate(dialogRef)">Send Emails</button>
    <button class="secondary" md-button type="button" (click)="dialogRef.close(true)">Close</button>
  </div>
</template>
