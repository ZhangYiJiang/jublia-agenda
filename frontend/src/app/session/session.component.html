<div *ngIf="session.placeholder" class="placeholder-session"></div>

<div *ngIf="!session.placeholder" class="session-tile" 
     [style.height]="session.start_at == null?'initial':height + 'px'" 
     [style.background-color]="color" 
     [class.pending]="session.start_at == null" 
     [class.static]="isPublic" 
     [class.dark]="useDarkTheme"
     (click)="clicked(false)" 
     [class.not-interested]="!interested">
  <div class="session-content">
    <div class="session-title">
      <i class="fa fa-star fa-fw" aria-hidden="true" *ngIf="interested"></i> {{session.name}}</div>
    <!-- session time format is 'HH:mm - HH:mm' -->
    <div *ngIf="session.start_at && session.duration > 30" class="session-time">
      {{getDisplayedTime()}}</div>
    <div *ngIf="!session.start_at && session.duration" class="session-time">
      {{session.duration}} min</div>
    <div class="session-venue" *ngIf="session.venue&& session.duration >= 60">{{ getVenue().name }}</div>
  </div>
</div>

<template id="session.id" #templateRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
  <div class="modal-container session-modal">
    <div class="modal-header">
      <button md-button disableRipple 
              *ngIf="isPublic"
              class="interestBtn" 
              [class.primary]="interested" 
              [class.secondary]="!interested" 
              (click)="updateInterest()">
        <i class="fa fa-star fa-fw" aria-hidden="true" *ngIf="interested"></i> {{interestedButtonText}}
      </button>

      <h1 class="full-width">
        <ndv-edit title="name" 
                  [placeholder]="session.name" 
                  (onSave)="updateSession($event)" 
                  [permission]="!isPublic"></ndv-edit>
      </h1>
    </div>
    <line-chart *ngIf="isAnalytics" 
                class="chart" 
                [dataY]="analyticsDataCombinedY" 
                [dataX]="analyticsDataCombinedX" 
                dataType="session"></line-chart>
    <div class="session-body">
      <div class="session-main">
        <p class="full-width" *ngIf="!isPublic || session.description">
          <ndv-area title="description" [placeholder]="session.description || 'Enter description here'" (onSave)="updateSession($event)" [permission]="!isPublic"></ndv-area>
        </p>
        
        <template [ngIf]="!isPublic || (session.speakers && session.speakers.length)">
          <h2>
            <i class="fa fa-user fa-fw" aria-hidden="true"></i> Speakers
          </h2>
          <div *ngIf="!isPublic">
            <select [ngModel]="selectedSpeaker" (ngModelChange)="addSessionSpeaker($event.id)">
              <option value="" disabled selected hidden>Select Speakers</option>
              <option [ngValue]="speaker" *ngFor="let speaker of availableSpeakers">{{ speaker.name }}</option>
            </select>
            <speaker-form [agenda]="agenda" (onSpeakerAdded)="onSpeakerAdded($event)"></speaker-form>
          </div>
          <div *ngIf="session.speakers">
            <div class="speaker-card" *ngFor="let speakerId of session.speakers">
              <h3>{{ speakersObj[speakerId].name }}
                <md-icon class="delete" tabindex="0" role="button" 
                         *ngIf="!isPublic" (click)="removeSessionSpeaker(speakerId)">clear</md-icon>
                <!-- name not editable for now to avoid uniqueness conflicts -->
                <!-- <ndv-edit [title]="'name'" [placeholder]="speakersObj[speakerId].name" (onSave)="updateSpeaker($event, speakerId)" [permission]="!isPublic"></ndv-edit> -->
              </h3>
              <p><ndv-edit title="position" 
                           [placeholder]="speakersObj[speakerId].position || 'Add company position'" 
                           (onSave)="updateSpeaker($event, speakerId)" 
                           [permission]="!isPublic"></ndv-edit>
              </p>
              <p>
                <ndv-area title="profile" 
                          [placeholder]="speakersObj[speakerId].profile || 'Add speaker profile'"
                          (onSave)="updateSpeaker($event, speakerId)" 
                          [permission]="!isPublic"></ndv-area>
              </p>
              <p>Email: <ndv-edit title="email" [placeholder]="speakersObj[speakerId].email || '-'" (onSave)="updateSpeaker($event, speakerId)" [permission]="!isPublic"></ndv-edit></p>
              <p>Phone: <ndv-edit title="phone_number" [placeholder]="speakersObj[speakerId].phone_number || '-'" (onSave)="updateSpeaker($event, speakerId)" [permission]="!isPublic"></ndv-edit></p>
            </div>
          </div>
          <div *ngIf="!session.speakers">
            <p>No speakers have been assigned to this session</p>
          </div>
        </template>
      </div><!-- /.session-main -->
      
      <div class="session-meta">
        <div class="session-sharing">
          <a href="{{ calendarLink() }}">
            <i class="fa fa-calendar" aria-hidden="true"></i> Export to iCal
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ permalink() | encodeURI }}">
            <i class="fa fa-facebook" aria-hidden="true"></i> Tell a friend
          </a>
          <a href="https://twitter.com/intent/tweet?url={{ permalink() | encodeURI }}">
            <i class="fa fa-twitter" aria-hidden="true"></i> Share
          </a>
          
        </div><!-- /.session-sharing -->
        
        <div class="session-info">
          <div class="session-icon">
            <i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>
          </div>
          <div>
            <p *ngIf="session.start_at">{{ getDisplayedDate() }}</p>
            <p *ngIf="!session.start_at && !isPublic">Duration</p>
            <p class="session-info-secondary">{{ getDisplayedTime() }}
              <ndv-edit class="small-input" 
                        title="duration" 
                        [placeholder]="session.duration || '0'"
                        (onSave)="updateSession($event)" 
                        [permission]="!isPublic"
                        regex="^[0-9]+$" 
                        error="Please enter a number.">
              </ndv-edit>mins
              <span *ngIf="!isPublic" class="duration-buttons">
                <button class="primary" md-button (click)="adjustSessionDuration(15)">+</button>
                <button class="primary" md-button (click)="adjustSessionDuration(-15)">-</button>
              </span>
            </p>
          </div>
        </div><!-- /.session-info -->
        
        <div class="session-info" *ngIf="!isPublic || session.venue">
          <div class="session-icon">
            <i class="fa fa-map-marker fa-fw" aria-hidden="true"></i>
          </div>
          <div>
            <div *ngIf="!isPublic">
              <select [ngModel]="selectedVenue" (ngModelChange)="addSessionVenue($event.id)">
                <option value="" disabled selected hidden>Select Venue</option>
                <option [ngValue]="venue" *ngFor="let venue of agenda.session_venues">{{ venue.name }}</option>
              </select>
            </div>
            <p *ngIf="isPublic">{{ getVenue().name }}</p>
            <p *ngIf="session.venue" class="session-info-secondary">
              <ndv-edit title="unit" 
                        [placeholder]="getVenue().unit || (!isPublic ? 'Add venue unit number' : '')" 
                        (onSave)="updateVenue($event)" 
                        [permission]="!isPublic"></ndv-edit></p>
          </div>
          <venue-form *ngIf="!isPublic" [agenda]="agenda" (onVenueAdded)="onVenueAdded($event)"></venue-form>
        </div><!-- /.session-info -->

        <div *ngIf="session.track" class="session-info">
          <div class="session-icon">
            <i class="fa fa-list-ol fa-fw" aria-hidden="true"></i>
          </div>
          <div>
            <p>{{trackObj[session.track].name}}</p>
          </div>
        </div><!-- /.session-info -->

        <div class="session-info">
          <div class="session-icon">
            <i class="fa fa-fire fa-fw" aria-hidden="true"></i>
          </div>
          <div>
            <p *ngIf="!agenda.published" class="session-info-secondary">Once this event has been published, you can see how many people have 
              bookmarked this session here</p>
            <p *ngIf="agenda.published">
              {{ session.popularity }} {{ session.popularity === 1 ? 'Bookmark' : 'Bookmarks' }}</p>
          </div>
        </div><!-- /.session-info -->

        <div *ngIf="sessionTagsName.length || !isPublic" class="session-info">
          <div class="session-icon">
            <i class="fa fa-tags fa-fw" aria-hidden="true"></i>
          </div>
          <div>
            <tag-input [(ngModel)]="sessionTagsName"
                       placeholder="Select or enter new tag" 
                       secondaryPlaceholder="Enter new tag"
                       [class.public]="isPublic"
                       [autocompleteItems]="eventTagsName" 
                       [autocomplete]="true"
                       [showDropdownIfEmpty]="true"
                       [readonly]="isPublic"
                       (onRemove)="removeTag($event)"
                       (onAdd)="addTag($event)"
                       (onTextChange)="onTagTextChange($event)"></tag-input>
            <button  *ngIf="!isPublic" class="secondary" md-button disableRipple="true" [disabled]="isNewTagBtnDisabled" (click)="addTagFromInput()">{{tagBtnText}}</button>
          </div>
        </div><!-- /.session-info -->        
      </div><!-- /.session-meta -->
    </div><!-- /.session-body -->
    
    <div class="session-footer">
      <button md-button disableRipple
              *ngIf="isPublic"
              class="interestBtn"
              [class.primary]="interested"
              [class.secondary]="!interested"
              (click)="updateInterest()">
        <i class="fa fa-star fa-fw" aria-hidden="true" *ngIf="interested"></i> {{interestedButtonText}}
      </button>

      <button type="button" md-button class="secondary" (click)="dialogRef.close(true)">Close</button>
      <button type="button" md-button class="warn" *ngIf="!isPublic" (click)="confirmDelete(dialogRef)">Delete</button>
    </div>
  </div>
</template>
