<div class="dashboard-container">
  <div class="sign-up-form" *ngIf = "signingUp">
    <h2>Register</h2>
    <form (ngSubmit)="signUp()" novalidate>
      <table>
      <tr><md-input placeholder="Email" required (focus)="clearSignUpErrors()" [(ngModel)]="registerEmail" name="email" autocomplete="new-password">
        <md-hint class="form-error-hint" align="start">{{registerEmailError}}</md-hint>
      </md-input> </tr>
      <tr><md-input placeholder="Password" required (focus)="clearSignUpErrors()" type="password" [(ngModel)]="registerPassword" name="password" autocomplete="new-password">
        <md-hint class="form-error-hint" align="start">{{registerPasswordError}}</md-hint>
      </md-input></tr>
      <tr><md-input placeholder="Event Organiser" [(ngModel)]="organiser" name="organiser"> </md-input></tr>
      <tr><md-input placeholder="Event Name" [(ngModel)]="event" name="event"> </md-input></tr>
      </table>
      <button class="primary" md-button type="submit" disableRipple="true">Register</button>
      <a class="secondary" md-button type="cancel" (click)="toggleSigningUp()">Cancel</a>      
    </form>
  </div>
  
  <div class="user-form" *ngIf = "!user.authed && !signingUp">
    <div class="log-in-card">
      <h2>Log In</h2>
      <form (ngSubmit)="logIn()" novalidate>
        <table>
        <tr><md-input (focus)="clearLoginErrors()" required placeholder="Email" [(ngModel)]="loginEmail" name="email"> 
          <md-hint class="form-error-hint" align="start">{{loginEmailError}}</md-hint>
        </md-input></tr>
        <tr><md-input (focus)="clearLoginErrors()" required placeholder="Password" type="password" [(ngModel)]="loginPassword" name="password"> 
          <md-hint class="form-error-hint" align="start">{{loginPasswordError}}</md-hint>
        </md-input></tr>
        </table>
        <button class="primary" md-button type="submit" disableRipple="true">Login</button>  
      </form>
    </div>
    <div class="sign-up-card">
      <p>Or create an account<br> and start building your event agenda</p>    
      <button class="secondary" md-button (click)="toggleSigningUp()">Register</button>
    </div>
  </div>
  
  <div class="dashboard-agendas" *ngIf="user.authed">
    <div class="agenda-list-card clearfix">
      <h2>All Events</h2>
      
      <ul class="agenda-list">
        <li *ngFor="let agenda of agendas; trackBy:trackByAgendaId; let isFirst=first" 
						[class.fly-in]="isFirst&&addNewAgenda" (click)="onSelect(agenda)" 
            role="link" tabindex="0">
          {{agenda.name}}

					<md-icon [hidden]="!deleting" (click)="callDeleteAgenda($event, agenda)" class="warn" 
                   role="button" tabindex="0">clear</md-icon>
        </li>
      </ul>
      
      <a class="delete-button" (click)="deleting =! deleting" role="button" tabindex="0">
        <md-icon class="delete">delete</md-icon>Delete Events
      </a>
    </div>
    <div class = "new-agenda-card">
      <h2>New Event</h2>
      <form [formGroup]="agendaForm" novalidate (ngSubmit)="submitAgendaForm()">
        <div>
          <md-input type="text" (focus)="clearError('name')" required formControlName="name" 
                    placeholder="Name">
            <md-hint class="form-error-hint" align="start">{{formErrors.name}}</md-hint>
          </md-input>
        </div>
        
        <div>
          <md-input type="text" (focus)="clearError()" formControlName="description" 
                       placeholder="Abstract">
          </md-input>
        </div>
        
        <!-- TODO: change to and style textarea (not in md yet) -->    
        <div>
          <md-input type="text" (focus)="clearError('start')" formControlName="location" 
                    placeholder="Location"></md-input>
        </div>
        <div>
          <md-input type="date" min="{{today}}" (focus)="clearError('start')" required 
                    formControlName="start" placeholder="Start Date">
            <md-hint class="form-error-hint" align="start">{{formErrors.start}}</md-hint>
          </md-input>
        </div>
        
        <div>
          <md-input type="number" (focus)="clearError('duration')" class="above-tags" 
                    formControlName="duration" max="9" min="1" placeholder="Duration (days, max 9)">
            <md-hint class="form-error-hint" align="start">{{formErrors.duration}}</md-hint>
          </md-input>
        </div>
        
        <div>
          <md-input type="url" (focus)="clearError('website')" formControlName="website" 
                    placeholder="Organiser website">
            <md-hint class="form-error-hint" align="start">{{formErrors.website}}</md-hint>
          </md-input>
        </div>
        
        <div class="field-with-label">
          <p class="field-label">Tracks (max 3)</p>
          <tag-input [ngModel]="agendaForm.tracks" [maxItems]="3" [placeholder]="options.placeholder" 
                     [secondaryPlaceholder]="options.secondaryPlaceholder" formControlName="tracks"></tag-input>
        </div>
        <div>
          <div class="other-error form-error-hint">{{formErrors.other}}</div>
          <button class="primary" md-button type="submit">Submit</button>
        </div>
      </form>
    </div>
  </div>
</div>

<template #templateRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
	<div class="modal-container">
		<p><span class="vex-deleted-agenda-title">{{deletedAgenda.name}}</span> has been published. Public will have 
			no access to the schedule after you deleting it. Are you sure?</p>
		<div class="vex-2-button-group">
			<button class="warn" md-button type="button" (click)="deleteAgenda(deletedAgenda,dialogRef)">Yes</button>
			<button class="secondary" md-button type="button" (click)="dialogRef.close(true)">No</button>
		</div>
	</div>
</template>

<template #signUpSuccessRef let-dialogRef="dialogRef" let-ctx="dialogRef.context">
	<div class="modal-container">
		<p>Sign Up success! Please check your email and click on the verification link.</p>
		<div class="vex-1-button-group">
			<button class="primary" md-button type="button" (click)="dialogRef.close(true)">OK</button>
		</div>
	</div>
</template>
